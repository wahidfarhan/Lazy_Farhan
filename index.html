<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Practice C with GitHub Repo Explorer</title>

<!-- Prism.js styles and plugins -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-vsc-dark-plus.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />

<style>
  /* Basic Reset & layout */
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    display: flex;
  }
  /* Sidebar */
  #sidebar {
    width: 320px;
    background: #161b22;
    border-right: 3px solid #30363d;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }
  #sidebar h2 {
    margin: 0 0 15px 0;
    color: #238636;
    border-bottom: 2px solid #238636;
    padding-bottom: 6px;
  }
  #backButton {
    background-color: #238636;
    border: none;
    color: white;
    padding: 6px 12px;
    margin-bottom: 10px;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
  }
  #backButton:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  #fileTreeContainer {
    flex: 1;
    overflow-y: auto;
  }
  ul.file-tree {
    list-style: none;
    padding-left: 20px;
    margin: 0;
  }
  ul.file-tree li {
    cursor: pointer;
    padding: 4px 6px;
    border-radius: 4px;
    user-select: none;
  }
  ul.file-tree li:hover {
    background-color: #238636;
    color: #fff;
  }
  ul.file-tree li.folder > span::before {
    content: "ðŸ“ ";
  }
  ul.file-tree li.file > span::before {
    content: "ðŸ“„ ";
  }
  ul.file-tree li.folder > span.open::before {
    content: "ðŸ“‚ ";
  }
  ul.file-tree li.folder > ul {
    display: none;
  }
  ul.file-tree li.folder.open > ul {
    display: block;
  }

  /* Main content area */
  #main {
    flex: 1;
    padding: 15px;
    display: flex;
    flex-direction: column;
    background: #0d1117;
    overflow: hidden;
  }

  /* Code container with Prism */
  #codeContainer {
    flex: 1;
    background: #0d1117;
    border: 3px solid #238636;
    border-radius: 6px;
    overflow: auto;
    margin-bottom: 10px;
  }
  pre {
    margin: 0;
    padding: 15px;
    font-size: 14px;
  }

  /* I/O and description container */
  #ioDescriptionContainer {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  .box {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .box label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #238636;
  }
  textarea, pre.descriptionBox {
    background-color: #161b22;
    border: 3px solid #238636;
    border-radius: 6px;
    color: #c9d1d9;
    font-family: 'Courier New', Courier, monospace;
    font-size: 14px;
    padding: 10px;
    resize: vertical;
    min-height: 80px;
    max-height: 150px;
    overflow-y: auto;
  }
  textarea#input {
    resize: vertical;
  }
  textarea#output {
    resize: vertical;
    color: #00ff00;
  }
  pre.descriptionBox {
    white-space: pre-wrap;
  }

  /* Run button */
  #runBtn {
    background-color: #238636;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    align-self: flex-start;
    transition: background-color 0.3s ease;
  }
  #runBtn:hover:not(:disabled) {
    background-color: #34a853;
  }
  #runBtn:disabled {
    background-color: #555;
    cursor: not-allowed;
  }

  /* Status message */
  #statusMsg {
    margin-top: 8px;
    font-style: italic;
    min-height: 20px;
    color: #999;
  }

  /* Scrollbar styling */
  #sidebar::-webkit-scrollbar,
  #fileTreeContainer::-webkit-scrollbar,
  #codeContainer::-webkit-scrollbar,
  textarea::-webkit-scrollbar,
  pre.descriptionBox::-webkit-scrollbar {
    width: 8px;
  }
  #sidebar::-webkit-scrollbar-thumb,
  #fileTreeContainer::-webkit-scrollbar-thumb,
  #codeContainer::-webkit-scrollbar-thumb,
  textarea::-webkit-scrollbar-thumb,
  pre.descriptionBox::-webkit-scrollbar-thumb {
    background-color: #000;
    border-radius: 4px;
  }

  /* Hacker text animation */
  #hackerText {
    margin-top: auto;
    font-family: monospace;
    color: #0f9d58;
    height: 25px;
    overflow: hidden;
    white-space: nowrap;
    border-right: 3px solid #0f9d58;
    animation: blink-caret 0.8s step-end infinite;
  }
  @keyframes blink-caret {
    50% { border-color: transparent; }
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Repository Explorer</h2>
  <button id="backButton" disabled>â¬… Back</button>
  <div id="fileTreeContainer">Loading...</div>
</div>

<div id="main">
  <div id="codeContainer">
    <pre class="line-numbers language-c"><code class="language-c">Select a file to view code...</code></pre>
  </div>

  <div id="ioDescriptionContainer">
    <div class="box">
      <label for="input">Input</label>
      <textarea id="input" placeholder="Input will appear here"></textarea>
    </div>
    <div class="box">
      <label for="output">Output</label>
      <textarea id="output" readonly placeholder="Output will appear here"></textarea>
    </div>
    <div class="box">
      <label>Description <span id="descFileName" style="font-weight:normal;color:#999;margin-left:8px;"></span></label>
      <pre class="descriptionBox" id="descriptionBox">Description will appear here</pre>
    </div>
  </div>

  <button id="runBtn" disabled>Run Code</button>
  <div id="statusMsg"></div>

  <div id="hackerText"></div>
</div>

<!-- Prism.js -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

<script>
const repoOwner = "wahidfarhan";
const repoName = "Lazy_Farhan";

const fileTreeContainer = document.getElementById("fileTreeContainer");
const codeContainer = document.querySelector("#codeContainer code");
const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const descriptionBox = document.getElementById("descriptionBox");
const descFileName = document.getElementById("descFileName");
const runBtn = document.getElementById("runBtn");
const statusMsg = document.getElementById("statusMsg");
const backButton = document.getElementById("backButton");
const hackerTextEl = document.getElementById("hackerText");

let pathStack = [];
let currentPath = "";
let currentFile = "";

// RapidAPI Judge0 credentials (update your own key)
const rapidApiHost = "judge0-ce.p.rapidapi.com";
const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";

function resetUI() {
  codeContainer.textContent = "Select a file to view code...";
  Prism.highlightElement(codeContainer);
  inputEl.value = "";
  outputEl.value = "";
  descriptionBox.textContent = "Description will appear here";
  descFileName.textContent = "";
  runBtn.disabled = true;
  statusMsg.textContent = "";
}

async function fetchFolderContents(path = "") {
  const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
  try {
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error(`Failed to fetch path: ${path}`);
    const data = await res.json();
    return data;
  } catch (err) {
    console.error(err);
    statusMsg.textContent = "Error loading repository contents.";
    return null;
  }
}

async function createTree(path = "", container) {
  const contents = await fetchFolderContents(path);
  if (!contents) return;

  container.innerHTML = "";

  const ul = document.createElement("ul");
  ul.classList.add("file-tree");

  contents.forEach(item => {
    if (item.type === "file" && !item.name.endsWith(".c") && !item.type === "dir") {
      // Skip non-.c files and non-directories
      return;
    }
    const li = document.createElement("li");
    const span = document.createElement("span");
    span.textContent = item.name;

    if (item.type === "dir") {
      li.classList.add("folder");
      span.addEventListener("click", async (e) => {
        e.stopPropagation();
        pathStack.push(path);
        backButton.disabled = false;
        await loadPath(item.path);
      });
    } else if (item.type === "file" && item.name.endsWith(".c")) {
      li.classList.add("file");
      span.addEventListener("click", async (e) => {
        e.stopPropagation();
        statusMsg.textContent = "Loading file...";
        try {
          // Fetch code content
          const res = await fetch(item.download_url);
          if (!res.ok) throw new Error("Failed to fetch file content");
          const code = await res.text();

          // Highlight code properly
          codeContainer.className = "language-c";
          codeContainer.textContent = code;
          Prism.highlightElement(codeContainer);

          // Reset I/O and description
          inputEl.value = "";
          outputEl.value = "";
          descriptionBox.textContent = "";
          descFileName.textContent = "";

          currentFile = item.name;
          currentPath = path;

          // Load matching .in file for input, description, output
          const inFileName = item.name.replace(/\.[^.]+$/, "") + ".in";
          const inFileObj = contents.find(f => f.name === inFileName);
          if (inFileObj) {
            const inRes = await fetch(inFileObj.download_url);
            if (inRes.ok) {
              const inText = await inRes.text();
              parseInputFile(inText, inFileName);
            } else {
              descriptionBox.textContent = "Failed to load input file.";
            }
          } else {
            descriptionBox.textContent = "No input file found.";
          }

          runBtn.disabled = false;
          statusMsg.textContent = `Loaded ${item.name}`;
        } catch (error) {
          codeContainer.textContent = "Error loading file content.";
          statusMsg.textContent = "";
          runBtn.disabled = true;
          console.error(error);
        }
      });
    }

    li.appendChild(span);
    ul.appendChild(li);
  });

  container.appendChild(ul);
}

function parseInputFile(text, filename) {
  /*
    Format expected in .in file:

    <input lines>
    description
    <description lines>
    output
    <expected output lines>

    - The keywords "description" and "output" must appear alone in their own line.
  */

  const lines = text.split(/\r?\n/);
  let inputLines = [];
  let descriptionLines = [];
  let outputLines = [];

  let mode = "input";
  for (const line of lines) {
    const trimmed = line.trim().toLowerCase();
    if (trimmed === "description") {
      mode = "description";
      continue;
    }
    if (trimmed === "output") {
      mode = "output";
      continue;
    }

    if (mode === "input") inputLines.push(line);
    else if (mode === "description") descriptionLines.push(line);
    else if (mode === "output") outputLines.push(line);
  }

  inputEl.value = inputLines.join("\n").trim();
  descriptionBox.textContent = descriptionLines.join("\n").trim() || "No description provided.";
  outputEl.value = outputLines.join("\n").trim();

  descFileName.textContent = filename;
}

async function loadPath(path = "") {
  statusMsg.textContent = "";
  resetUI();
  await createTree(path, fileTreeContainer);
  currentPath = path;
}

backButton.addEventListener("click", async () => {
  if (pathStack.length === 0) return;
  const prevPath = pathStack.pop();
  await loadPath(prevPath);
  if (pathStack.length === 0) backButton.disabled = true;
  resetUI();
});

// Run Code Logic with Judge0 API
async function runCode() {
  if (!currentFile) {
    alert("Please select a C file first.");
    return;
  }
  outputEl.value = "";
  statusMsg.textContent = "Running...";
  runBtn.disabled = true;

  // Prepare code and input
  const source_code = codeContainer.textContent;
  const stdin = inputEl.value;

  try {
    const response = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=false&wait=true`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-RapidAPI-Host": rapidApiHost,
        "X-RapidAPI-Key": rapidApiKey,
      },
      body: JSON.stringify({
        source_code,
        language_id: 50, // C language in Judge0
        stdin,
      }),
    });

    if (!response.ok) throw new Error(`API error: ${response.status}`);

    const result = await response.json();

    if (result.stderr) {
      outputEl.value = `Runtime Error:\n${result.stderr}`;
    } else if (result.compile_output) {
      outputEl.value = `Compile Error:\n${result.compile_output}`;
    } else if (result.message) {
      outputEl.value = `Error:\n${result.message}`;
    } else {
      outputEl.value = result.stdout || "";
    }
  } catch (error) {
    outputEl.value = "Error running code: " + error.message;
    console.error(error);
  } finally {
    statusMsg.textContent = "";
    runBtn.disabled = false;
  }
}

runBtn.addEventListener("click", runCode);

// Hacker style typing animation
const hackerTexts = [
  "lazy_farhan@github ~ $ ",
  "Compiling code...",
  "Running tests...",
  "All tests passed.",
  "Pushing changes to repo...",
  "Deployment successful."
];
let hackerIndex = 0;
let charIndex = 0;
let currentText = "";
let typingForward = true;

function hackerType() {
  if (typingForward) {
    currentText = hackerTexts[hackerIndex].slice(0, charIndex + 1);
    charIndex++;
    if (charIndex === hackerTexts[hackerIndex].length) typingForward = false;
  } else {
    currentText = hackerTexts[hackerIndex].slice(0, charIndex - 1);
    charIndex--;
    if (charIndex === 0) {
      typingForward = true;
      hackerIndex = (hackerIndex + 1) % hackerTexts.length;
    }
  }
  hackerTextEl.textContent = currentText;
  setTimeout(hackerType, 100);
}
hackerType();

// Initialize
loadPath();

</script>
</body>
</html>
