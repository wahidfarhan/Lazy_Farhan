<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline' https://cdnjs.cloudflare.com; script-src 'self' https://cdnjs.cloudflare.com; connect-src https://judge0-ce.p.rapidapi.com https://api.github.com;" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My C Practice Codes</title>

<!-- Prism.js Dark theme CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

<style>
  body {
    background: #121212;
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    height: 100vh;
  }
  /* Sidebar */
  #file-list {
    width: 300px;
    background: #1e1e1e;
    overflow-y: auto;
    border-right: 3px solid #333;
    padding: 15px;
  }
  #file-list h2 {
    margin-top: 0;
    color: #8bc34a;
    font-weight: 700;
    text-align: center;
  }
  #file-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #file-list li {
    padding: 10px 12px;
    margin-bottom: 6px;
    background: #272727;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #file-list li:hover {
    background: #3c763d;
  }
  #file-list li.active {
    background: #558b2f;
  }

  /* Main content */
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #181818;
  }

  /* Code display */
  #code-container {
    flex: 1;
    overflow: auto;
    padding: 15px;
    border-bottom: 3px solid #333;
  }
  pre {
    margin: 0;
    font-size: 14px;
    line-height: 1.5;
    border-radius: 6px;
  }

  /* Input area */
  #input-container {
    padding: 15px;
    background: #222;
    border-bottom: 3px solid #333;
  }
  #input-container label {
    display: block;
    margin-bottom: 6px;
    font-weight: 600;
  }
  #input-field {
    width: 100%;
    min-height: 60px;
    background: #121212;
    color: #ddd;
    border: 2px solid #3c763d;
    border-radius: 5px;
    padding: 8px;
    font-family: monospace;
    font-size: 13px;
    resize: vertical;
  }

  /* Run button */
  #run-btn {
    margin-top: 10px;
    background: #558b2f;
    border: none;
    color: white;
    padding: 10px 18px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.25s ease;
  }
  #run-btn:hover {
    background: #77ab4b;
  }

  /* Output box */
  #output-container {
    padding: 15px;
    background: #222;
    color: #adff2f;
    font-family: monospace;
    font-size: 14px;
    min-height: 100px;
    overflow-y: auto;
    white-space: pre-wrap;
    border-top: 3px solid #333;
  }
</style>

<!-- Prism.js core + C language -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>

</head>
<body>

<div id="file-list">
  <h2>My C Practice</h2>
  <ul id="files-ul">
    <!-- ফাইল নামগুলো এখানে লোড হবে -->
  </ul>
</div>

<div id="main">
  <div id="code-container">
    <pre><code id="code-block" class="language-c">Select a file to view its code.</code></pre>
  </div>

  <div id="input-container">
    <label for="input-field">Input (stdin):</label>
    <textarea id="input-field" placeholder="Enter input for your C program here..."></textarea>
    <button id="run-btn">Run Code</button>
  </div>

  <div id="output-container" tabindex="0" aria-label="Output">
    Output will appear here...
  </div>
</div>

<script>
  const repoOwner = "wahidfarhan";
  const repoName = "Lazy_Farhan";
  const folderPath = "codes"; // যেখানে তোমার .c ফাইলগুলো আছে

  const filesUl = document.getElementById("files-ul");
  const codeBlock = document.getElementById("code-block");
  const inputField = document.getElementById("input-field");
  const runBtn = document.getElementById("run-btn");
  const outputContainer = document.getElementById("output-container");

  // তোমার RapidAPI key & host
  const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";
  const rapidApiHost = "judge0-ce.p.rapidapi.com";

  // GitHub API থেকে ফাইল লিস্ট লোড
  async function loadFileList() {
    try {
      const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`);
      if (!response.ok) throw new Error("Failed to fetch file list");
      const files = await response.json();

      filesUl.innerHTML = "";
      files.forEach(file => {
        if (file.name.endsWith(".c")) {
          const li = document.createElement("li");
          li.textContent = file.name;
          li.tabIndex = 0;
          li.addEventListener("click", () => selectFile(file));
          li.addEventListener("keypress", e => {
            if (e.key === "Enter") selectFile(file);
          });
          filesUl.appendChild(li);
        }
      });
    } catch (err) {
      filesUl.innerHTML = `<li style="color:red;">Error loading files: ${err.message}</li>`;
    }
  }

  let selectedFile = null;

  // ফাইল সিলেক্ট করলে কোড লোড এবং দেখানো
  async function selectFile(file) {
    selectedFile = file;
    // active ক্লাস হ্যান্ডেল
    [...filesUl.children].forEach(li => li.classList.remove("active"));
    event.target.classList.add("active");

    codeBlock.textContent = "Loading...";
    outputContainer.textContent = "";
    inputField.value = "";

    try {
      const res = await fetch(file.download_url);
      if (!res.ok) throw new Error("Failed to fetch code file");
      const codeText = await res.text();

      // Prism দিয়ে syntax highlight করে দেখাও
      codeBlock.innerHTML = Prism.highlight(codeText, Prism.languages.c, "c");
    } catch (err) {
      codeBlock.textContent = `Error loading code: ${err.message}`;
    }
  }

  // কোড রান করার জন্য RapidAPI Judge0 ব্যবহার
  async function runCode() {
    if (!selectedFile) {
      alert("Please select a file first!");
      return;
    }

    outputContainer.textContent = "Running...";

    // কোড আবার API থেকে নিয়ে আসা (দেখানোর কোডে থাকতে পারে পরিবর্তিত হলে)
    let codeText;
    try {
      const res = await fetch(selectedFile.download_url);
      if (!res.ok) throw new Error("Failed to fetch code file");
      codeText = await res.text();
    } catch (err) {
      outputContainer.textContent = `Error fetching code for execution: ${err.message}`;
      return;
    }

    // RapidAPI এর জন্য request body
    const postData = {
      language_id: 50, // C language এর id Judge0 এ
      source_code: codeText,
      stdin: inputField.value
    };

    try {
      const response = await fetch("https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-RapidAPI-Host": rapidApiHost,
          "X-RapidAPI-Key": rapidApiKey
        },
        body: JSON.stringify(postData)
      });

      if (!response.ok) throw new Error(`Judge0 API error: ${response.statusText}`);

      const result = await response.json();

      if (result.stdout) {
        outputContainer.textContent = result.stdout;
      } else if (result.compile_output) {
        outputContainer.textContent = `Compile error:\n${result.compile_output}`;
      } else if (result.stderr) {
        outputContainer.textContent = `Runtime error:\n${result.stderr}`;
      } else {
        outputContainer.textContent = "No output.";
      }
    } catch (err) {
      outputContainer.textContent = `Error running code: ${err.message}`;
    }
  }

  runBtn.addEventListener("click", runCode);

  loadFileList();
</script>

</body>
</html>
