<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Practice C - Run Your Code</title>

<!-- Prism.js for syntax highlighting -->
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />

<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    height: 100vh;
  }
  #sidebar {
    width: 320px;
    background-color: #1e1e1e;
    border-right: 3px solid #333;
    padding: 15px;
    overflow-y: auto;
  }
  #sidebar h2 {
    margin-top: 0;
    margin-bottom: 15px;
    border-bottom: 2px solid #0f9d58;
    padding-bottom: 5px;
    color: #0f9d58;
  }
  #fileList {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #fileList li {
    padding: 10px;
    margin-bottom: 5px;
    background-color: #222;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    border: 2px solid transparent;
  }
  #fileList li:hover {
    background-color: #333;
  }
  #fileList li.active {
    background-color: #0f9d58;
    color: #fff;
    border: 2px solid #0f9d58;
  }

  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    background-color: #181818;
  }
  #codeContainer {
    flex: 1;
    overflow: auto;
    border: 3px solid #0f9d58;
    border-radius: 6px;
    margin-bottom: 15px;
    background: #121212;
  }
  pre {
    margin: 0;
    padding: 15px;
    font-size: 14px;
  }
  /* Prism line numbers */
  .line-numbers {
    padding-left: 50px !important;
  }
  /* Input and Output containers */
  .io-container {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
  }
  .io-box {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .io-box label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #0f9d58;
  }
  textarea#input, textarea#output {
    background-color: #222;
    color: #eee;
    border: 3px solid #0f9d58;
    border-radius: 6px;
    padding: 10px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 14px;
    resize: vertical;
    min-height: 80px;
    max-height: 150px;
    transition: border-color 0.3s ease;
  }
  textarea#input:focus, textarea#output:focus {
    border-color: #34a853;
    outline: none;
    background-color: #2a2a2a;
  }
  #runBtn {
    background-color: #0f9d58;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    align-self: flex-start;
    transition: background-color 0.3s ease;
  }
  #runBtn:hover {
    background-color: #34a853;
  }
  #statusMsg {
    margin-top: 10px;
    font-style: italic;
    min-height: 20px;
    color: #ccc;
  }
  /* Scrollbar styles for sidebar and code */
  #sidebar::-webkit-scrollbar, #codeContainer::-webkit-scrollbar {
    width: 8px;
  }
  #sidebar::-webkit-scrollbar-thumb, #codeContainer::-webkit-scrollbar-thumb {
    background-color: #0f9d58;
    border-radius: 4px;
  }
</style>
</head>
<body>

<div id="sidebar">
  <h2>My Practice C</h2>
  <ul id="fileList">
    <li>Loading files...</li>
  </ul>
</div>

<div id="main">
  <div id="codeContainer">
    <pre id="codeBlock" class="line-numbers language-c"><code>// Select a file to see code here...</code></pre>
  </div>

  <div class="io-container">
    <div class="io-box">
      <label for="input">Input</label>
      <textarea id="input" placeholder="Type input here (if any)"></textarea>
    </div>
    <div class="io-box">
      <label for="output">Output</label>
      <textarea id="output" readonly placeholder="Output will appear here"></textarea>
    </div>
  </div>

  <button id="runBtn">Run Code</button>
  <div id="statusMsg"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

<script>
const repoOwner = "wahidfarhan";
const repoName = "Lazy_Farhan";
const folderPath = "codes";
const rapidApiHost = "judge0-ce.p.rapidapi.com";
const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02"; // তোমার RapidAPI key এখানে বসাও

const fileListEl = document.getElementById("fileList");
const codeBlockEl = document.getElementById("codeBlock");
const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const runBtn = document.getElementById("runBtn");
const statusMsg = document.getElementById("statusMsg");

let currentCode = "";
let currentFileName = "";

// Fetch file list from GitHub API
async function fetchFileList() {
  try {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error("Failed to fetch file list");
    const data = await res.json();

    const cFiles = data.filter(file => file.name.endsWith(".c"));
    if (cFiles.length === 0) {
      fileListEl.innerHTML = "<li>No C files found in repo</li>";
      return;
    }

    fileListEl.innerHTML = "";
    cFiles.forEach(file => {
      const li = document.createElement("li");
      li.textContent = file.name;
      li.title = file.name;
      li.addEventListener("click", () => selectFile(file));
      fileListEl.appendChild(li);
    });
  } catch (err) {
    fileListEl.innerHTML = `<li style="color:#f44336;">Error loading files</li>`;
    console.error(err);
  }
}

// Load code content from GitHub and show
async function selectFile(file) {
  try {
    // Remove active class from all
    [...fileListEl.children].forEach(li => li.classList.remove("active"));

    currentFileName = file.name;
    // Add active class on selected
    const selectedLi = [...fileListEl.children].find(li => li.textContent === file.name);
    if (selectedLi) selectedLi.classList.add("active");

    const res = await fetch(file.download_url);
    if (!res.ok) throw new Error("Failed to fetch code");
    const codeText = await res.text();

    currentCode = codeText;
    codeBlockEl.textContent = currentCode;
    Prism.highlightElement(codeBlockEl);
    outputEl.value = "";
    inputEl.value = "";
    statusMsg.textContent = "";
  } catch (err) {
    statusMsg.textContent = "Error loading code file.";
    console.error(err);
  }
}

// Run code using Judge0 API
async function runCode() {
  if (!currentCode) {
    alert("Please select a C file first.");
    return;
  }
  outputEl.value = "";
  statusMsg.textContent = "Running...";
  runBtn.disabled = true;

  try {
    const postData = {
      source_code: currentCode,
      language_id: 50, // C (gcc 9.2.0)
      stdin: inputEl.value
    };

    const response = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=false&wait=true`, {
      method: "POST",
      headers: {
        "content-type": "application/json",
        "X-RapidAPI-Host": rapidApiHost,
        "X-RapidAPI-Key": rapidApiKey
      },
      body: JSON.stringify(postData)
    });

    if (!response.ok) throw new Error(`API error: ${response.status}`);

    const result = await response.json();

    if (result.stderr) {
      outputEl.value = `Error:\n${result.stderr}`;
    } else if (result.compile_output) {
      outputEl.value = `Compile Error:\n${result.compile_output}`;
    } else if (result.message) {
      outputEl.value = `Error:\n${result.message}`;
    } else {
      outputEl.value = result.stdout || "";
    }
  } catch (error) {
    outputEl.value = "Error running code: " + error.message;
    console.error(error);
  } finally {
    statusMsg.textContent = "";
    runBtn.disabled = false;
  }
}

runBtn.addEventListener("click", runCode);

fetchFileList();
</script>

</body>
</html>
