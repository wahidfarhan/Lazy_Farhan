<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Practice C - Run Your Code</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wcoder/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.css" />

<style>
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    overflow: hidden;
  }
  #container {
    flex: 1;
    display: flex;
    overflow: hidden;
  }
  #sidebar {
    width: 280px;
    background: #161b22;
    border-right: 3px solid #30363d;
    padding: 15px;
    overflow-y: auto;
  }
  #sidebar h2 {
    margin: 0 0 15px;
    border-bottom: 2px solid #238636;
    color: #238636;
  }
  #fileList {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #fileList li {
    background: #21262d;
    padding: 8px;
    margin-bottom: 6px;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  #fileList li.active {
    background: #238636;
    color: white;
  }
  #fileList li:hover:not(.active) {
    background: #2ea043;
    color: white;
  }

  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    overflow: hidden;
    position: relative;
  }
  #codeSection {
    display: flex;
    gap: 20px;
    flex: 1;
    overflow: hidden;
  }
  #codeContainer {
    flex: 2;
    background: #0d1117;
    border: 3px solid #238636;
    border-radius: 6px;
    overflow: auto;
  }
  pre {
    margin: 0;
    font-size: 14px;
    padding: 15px;
    min-height: 100%;
  }
  .hljs td.hljs-ln-code {
    padding-left: 12px;
  }
  #ioSide {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 12px;
    overflow: hidden;
  }
  .io-box label {
    font-weight: bold;
    color: #238636;
    margin-bottom: 5px;
  }
  textarea {
    width: 100%;
    background-color: #21262d;
    color: #c9d1d9;
    border: 2px solid #238636;
    border-radius: 5px;
    padding: 10px;
    resize: vertical;
    min-height: 80px;
    font-family: monospace;
    font-size: 14px;
  }
  #output {
    color: #56d364;
  }
  .readonly-box {
    background-color: #1e1e1e;
    border: 2px solid #444;
    border-radius: 5px;
    padding: 10px;
    white-space: pre-wrap;
    font-size: 14px;
    min-height: 80px;
    overflow-y: auto;
  }
  #runBtn {
    margin-top: 10px;
    background: #238636;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    align-self: flex-start;
  }
  #runBtn:hover {
    background: #2ea043;
  }
  #statusMsg {
    margin-top: 8px;
    color: #999;
    min-height: 20px;
    font-style: italic;
  }

  /* Scrollbar black */
  #sidebar::-webkit-scrollbar,
  #codeContainer::-webkit-scrollbar,
  #ioSide::-webkit-scrollbar,
  .readonly-box::-webkit-scrollbar {
    width: 8px;
  }
  #sidebar::-webkit-scrollbar-thumb,
  #codeContainer::-webkit-scrollbar-thumb,
  #ioSide::-webkit-scrollbar-thumb,
  .readonly-box::-webkit-scrollbar-thumb {
    background-color: #000000;
    border-radius: 4px;
  }
  #sidebar::-webkit-scrollbar-track,
  #codeContainer::-webkit-scrollbar-track,
  #ioSide::-webkit-scrollbar-track,
  .readonly-box::-webkit-scrollbar-track {
    background-color: #121212;
  }
  /* Firefox */
  #sidebar,
  #codeContainer,
  #ioSide,
  .readonly-box {
    scrollbar-width: thin;
    scrollbar-color: #000000 #121212;
  }
</style>
</head>
<body>
<div id="container">
  <div id="sidebar">
    <h2>My Practice C</h2>
    <ul id="fileList"><li>Loading files...</li></ul>
  </div>

  <div id="main">
    <div id="codeSection">
      <div id="codeContainer">
        <pre><code id="codeBlock" class="language-c hljs"></code></pre>
      </div>
      <div id="ioSide">
        <div class="io-box">
          <label for="input">üì• Input</label>
          <textarea id="input" placeholder="Input will be loaded here or you can type"></textarea>
        </div>
        <div class="io-box">
          <label for="output">üì§ Output</label>
          <textarea id="output" readonly placeholder="Program output will appear here"></textarea>
        </div>
        <div class="io-box">
          <label>‚úÖ Expected Output</label>
          <div id="expectedOutput" class="readonly-box">Not loaded</div>
        </div>
        <div class="io-box">
          <label>üìù Description <span id="fileNameLabel" style="color:#56d364; font-weight: normal; font-size: 0.9em; margin-left: 8px;"></span></label>
          <div id="descriptionBox" class="readonly-box">No description available.</div>
        </div>
      </div>
    </div>
    <button id="runBtn">Run Code</button>
    <div id="statusMsg"></div>
    <div id="uploadedDate"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/wcoder/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>

<script>
const repoOwner = "wahidfarhan";
const repoName = "Lazy_Farhan";
const folderPath = "codes";
const rapidApiHost = "judge0-ce.p.rapidapi.com";
const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";

const fileListEl = document.getElementById("fileList");
const codeBlockEl = document.getElementById("codeBlock");
const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const runBtn = document.getElementById("runBtn");
const statusMsg = document.getElementById("statusMsg");
const descriptionEl = document.getElementById("descriptionBox");
const expectedOutputEl = document.getElementById("expectedOutput");
const fileNameLabel = document.getElementById("fileNameLabel");
const uploadedDateEl = document.getElementById("uploadedDate");

let currentCode = "";

async function fetchFileList() {
  try {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
    const res = await fetch(apiUrl);
    if (!res.ok) throw new Error("Failed to fetch file list");
    const data = await res.json();
    const cFiles = data.filter(file => file.name.endsWith(".c"));

    fileListEl.innerHTML = cFiles.map(file => `<li>${file.name}</li>`).join("");
    Array.from(fileListEl.children).forEach((li, idx) => {
      li.addEventListener("click", () => selectFile(cFiles[idx], li));
    });
  } catch (err) {
    fileListEl.innerHTML = `<li style="color:red;">Error loading files</li>`;
    console.error(err);
  }
}

async function selectFile(file, li) {
  [...fileListEl.children].forEach(el => el.classList.remove("active"));
  li.classList.add("active");

  try {
    const res = await fetch(file.download_url);
    const codeText = await res.text();
    currentCode = codeText;
    codeBlockEl.innerHTML = "";
    codeBlockEl.textContent = currentCode;
    setTimeout(() => {
      hljs.highlightElement(codeBlockEl);
      hljs.lineNumbersBlock(codeBlockEl);
    }, 0);
  } catch (err) {
    statusMsg.textContent = "Error loading code file.";
    console.error(err);
    return;
  }

  fileNameLabel.textContent = `(${file.name})`;
  const baseName = file.name.replace(/\.c$/, "");
  const inputUrl = file.download_url.replace(/\/[^/]+$/, `/${baseName}.in`);

  try {
    const inputRes = await fetch(inputUrl);
    const inputText = await inputRes.text();
    const inputTextLower = inputText.toLowerCase();
    const descIndex = inputTextLower.indexOf("description");
    const outputIndex = inputTextLower.indexOf("output");

    let inputData = "", descriptionData = "", expectedOutputData = "";
    if(descIndex !== -1 && outputIndex !== -1 && descIndex < outputIndex){
      inputData = inputText.substring(0, descIndex).trim();
      descriptionData = inputText.substring(descIndex + "description".length, outputIndex).trim();
      expectedOutputData = inputText.substring(outputIndex + "output".length).trim();
    } else if(descIndex !== -1){
      inputData = inputText.substring(0, descIndex).trim();
      descriptionData = inputText.substring(descIndex + "description".length).trim();
    } else {
      inputData = inputText.trim();
      descriptionData = "No description found.";
    }
    inputEl.value = inputData;
    descriptionEl.textContent = descriptionData;
    expectedOutputEl.textContent = expectedOutputData;
  } catch {
    inputEl.value = "";
    descriptionEl.textContent = "No input or description found.";
    expectedOutputEl.textContent = "";
  }

  outputEl.value = "";
  statusMsg.textContent = "";
}

async function runCode() {
  if (!currentCode) return alert("Please select a file first.");
  runBtn.disabled = true;
  statusMsg.textContent = "Running...";

  try {
    const res = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=false&wait=true`, {
      method: "POST",
      headers: {
        "content-type": "application/json",
        "X-RapidAPI-Host": rapidApiHost,
        "X-RapidAPI-Key": rapidApiKey
      },
      body: JSON.stringify({
        source_code: currentCode,
        language_id: 50,
        stdin: inputEl.value
      })
    });
    const result = await res.json();
    outputEl.value = result.stderr || result.compile_output || result.stdout || "";
  } catch (err) {
    outputEl.value = "Error running code: " + err.message;
  } finally {
    statusMsg.textContent = "";
    runBtn.disabled = false;
  }
}

runBtn.addEventListener("click", runCode);
fetchFileList();
</script>

</body>
</html>
