<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Practice C - Run Your Code</title>

<!-- Prism.js for syntax highlighting with VS Code-like theme -->
<link href="https://cdn.jsdelivr.net/npm/prism-themes/themes/prism-vsc-dark-plus.css" rel="stylesheet" />

<style>
  body {
    background-color: #121212;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex;
    height: 100vh;
  }
  #sidebar {
    width: 320px;
    background-color: #1e1e1e;
    border-right: 3px solid #333;
    padding: 15px;
    overflow-y: auto;
  }
  #sidebar h2 {
    margin-top: 0;
    margin-bottom: 15px;
    border-bottom: 2px solid #0f9d58;
    padding-bottom: 5px;
    color: #0f9d58;
  }
  #fileList {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #fileList li {
    padding: 10px;
    margin-bottom: 5px;
    background-color: #222;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    border: 2px solid transparent;
  }
  #fileList li:hover {
    background-color: #333;
  }
  #fileList li.active {
    background-color: #0f9d58;
    color: #fff;
    border: 2px solid #0f9d58;
  }
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    background-color: #181818;
  }
  #codeContainer {
    flex: 1;
    overflow: auto;
    border: 3px solid #0f9d58;
    border-radius: 6px;
    margin-bottom: 15px;
    background: #1e1e1e;
  }
  pre {
    margin: 0;
    padding: 15px;
    font-size: 14px;
  }
  .line-numbers {
    padding-left: 50px !important;
  }
  .io-container {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
  }
  .io-box {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .io-box label {
    font-weight: bold;
    margin-bottom: 5px;
    color: #0f9d58;
  }
  textarea#input, textarea#output {
    background-color: #222;
    color: #00ff00;
    border: 3px solid #0f9d58;
    border-radius: 6px;
    padding: 10px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 14px;
    resize: vertical;
    min-height: 80px;
    max-height: 150px;
    transition: border-color 0.3s ease;
  }
  textarea#input:focus, textarea#output:focus {
    border-color: #34a853;
    outline: none;
    background-color: #2a2a2a;
  }
  #runBtn {
    background-color: #0f9d58;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    align-self: flex-start;
    transition: background-color 0.3s ease;
  }
  #runBtn:hover {
    background-color: #34a853;
  }
  #statusMsg {
    margin-top: 10px;
    font-style: italic;
    min-height: 20px;
    color: #ccc;
  }
  #sidebar::-webkit-scrollbar, #codeContainer::-webkit-scrollbar {
    width: 8px;
  }
  #sidebar::-webkit-scrollbar-thumb, #codeContainer::-webkit-scrollbar-thumb {
    background-color: #0f9d58;
    border-radius: 4px;
  }
</style>
</head>
<body>
<div id="sidebar">
  <h2>My Practice C</h2>
  <ul id="fileList">
    <li>Loading files...</li>
  </ul>
</div>
<div id="main">
  <div id="codeContainer">
    <pre id="codeBlock" class="line-numbers language-c"><code>// Select a file to see code here...</code></pre>
  </div>
  <div class="io-container">
    <div class="io-box">
      <label for="input">Input</label>
      <textarea id="input" placeholder="Type input here (if any)"></textarea>
    </div>
    <div class="io-box">
      <label for="output">Output</label>
      <textarea id="output" readonly placeholder="Output will appear here"></textarea>
    </div>
  </div>
  <button id="runBtn">Run Code</button>
  <div id="statusMsg"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
<script>
const repoOwner = "wahidfarhan";
const repoName = "Lazy_Farhan";
const folderPath = "codes";
const rapidApiHost = "judge0-ce.p.rapidapi.com";
const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";

const fileListEl = document.getElementById("fileList");
const codeBlockEl = document.getElementById("codeBlock");
const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const runBtn = document.getElementById("runBtn");
const statusMsg = document.getElementById("statusMsg");

let currentCode = "";
let currentFileName = "";

async function fetchFileList() {
  try {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
    const res = await fetch(apiUrl);
    const data = await res.json();
    const cFiles = data.filter(file => file.name.endsWith(".c"));
    fileListEl.innerHTML = "";
    cFiles.forEach(file => {
      const li = document.createElement("li");
      li.textContent = file.name;
      li.title = file.name;
      li.addEventListener("click", () => selectFile(file, li));
      fileListEl.appendChild(li);
    });
  } catch (err) {
    fileListEl.innerHTML = `<li style="color:red;">Failed to load files</li>`;
  }
}

async function selectFile(file, liElement) {
  [...fileListEl.children].forEach(li => li.classList.remove("active"));
  liElement.classList.add("active");
  try {
    const res = await fetch(file.download_url);
    const code = await res.text();
    currentCode = code;
    currentFileName = file.name;
    codeBlockEl.textContent = code;
    Prism.highlightElement(codeBlockEl);
    inputEl.value = "";
    outputEl.value = "";
  } catch (err) {
    codeBlockEl.textContent = "Error loading code.";
  }
}

async function runCode() {
  if (!currentCode) return alert("Select a file first");
  outputEl.value = "";
  statusMsg.textContent = "Running...";
  runBtn.disabled = true;

  try {
    const postData = {
      source_code: currentCode,
      language_id: 50,
      stdin: inputEl.value
    };

    const response = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=false&wait=true`, {
      method: "POST",
      headers: {
        "content-type": "application/json",
        "X-RapidAPI-Host": rapidApiHost,
        "X-RapidAPI-Key": rapidApiKey
      },
      body: JSON.stringify(postData)
    });

    const result = await response.json();
    outputEl.value = result.stdout || result.stderr || result.compile_output || "";
  } catch (err) {
    outputEl.value = "Execution error";
  } finally {
    runBtn.disabled = false;
    statusMsg.textContent = "";
  }
}
runBtn.addEventListener("click", runCode);
fetchFileList();
</script>
</body>
</html>
