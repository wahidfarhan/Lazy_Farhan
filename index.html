<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Practice C - Run Your Code</title>

  <!-- highlight.js GitHub dark theme -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wcoder/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.css" />

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      display: flex;
      height: 100vh;
    }
    #sidebar {
      width: 280px;
      background: #161b22;
      padding: 15px;
      overflow-y: auto;
      border-right: 3px solid #30363d;
    }
    #sidebar h2 {
      color: #238636;
      border-bottom: 2px solid #238636;
      padding-bottom: 5px;
    }
    #fileList {
      list-style: none;
      padding: 0;
    }
    #fileList li {
      padding: 8px 12px;
      background: #21262d;
      margin-bottom: 6px;
      border-radius: 5px;
      cursor: pointer;
    }
    #fileList li.active {
      background: #238636;
      color: white;
    }

    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 15px;
    }

    #codeSection {
      display: flex;
      gap: 20px;
      flex: 1;
      overflow: hidden;
    }

    #codeContainer {
      flex: 2;
      background: #0d1117;
      border: 3px solid #238636;
      border-radius: 6px;
      overflow: auto;
    }

    pre {
      margin: 0;
      font-size: 14px;
      padding: 15px;
    }

    #ioSide {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .io-box label {
      font-weight: bold;
      color: #238636;
      margin-bottom: 5px;
      display: block;
    }

    textarea {
      width: 100%;
      background-color: #21262d;
      color: #c9d1d9;
      border: 2px solid #238636;
      border-radius: 5px;
      padding: 10px;
      resize: vertical;
      min-height: 100px;
      font-family: monospace;
      font-size: 14px;
    }

    #output {
      color: #56d364;
    }

    #runBtn {
      margin-top: 15px;
      background: #238636;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }

    #runBtn:hover {
      background: #2ea043;
    }

    #statusMsg {
      margin-top: 10px;
      color: #999;
      min-height: 20px;
      font-style: italic;
    }

    /* Line number spacing */
    .hljs td.hljs-ln-code {
      padding-left: 12px;
    }
  </style>
</head>
<body>

<div id="sidebar">
  <h2>My Practice C</h2>
  <ul id="fileList"><li>Loading files...</li></ul>
</div>

<div id="main">
  <div id="codeSection">
    <div id="codeContainer">
      <pre><code id="codeBlock" class="c hljs"></code></pre>
    </div>
    <div id="ioSide">
      <div class="io-box">
        <label for="input">ðŸ“¥ Sample Input</label>
        <textarea id="input" placeholder="Auto loaded or write here..."></textarea>
      </div>
      <div class="io-box">
        <label for="output">ðŸ“¤ Output</label>
        <textarea id="output" readonly></textarea>
      </div>
    </div>
  </div>
  <button id="runBtn">Run Code</button>
  <div id="statusMsg"></div>
</div>

<!-- highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/c.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/wcoder/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>

<script>
const repoOwner = "wahidfarhan";
const repoName = "Lazy_Farhan";
const folderPath = "codes";
const rapidApiHost = "judge0-ce.p.rapidapi.com";
const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";

const fileListEl = document.getElementById("fileList");
const codeBlockEl = document.getElementById("codeBlock");
const inputEl = document.getElementById("input");
const outputEl = document.getElementById("output");
const runBtn = document.getElementById("runBtn");
const statusMsg = document.getElementById("statusMsg");

let currentCode = "";

async function fetchFileList() {
  try {
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`;
    const res = await fetch(apiUrl);
    const data = await res.json();

    const cFiles = data.filter(file => file.name.endsWith(".c"));
    fileListEl.innerHTML = "";

    cFiles.forEach(file => {
      const li = document.createElement("li");
      li.textContent = file.name;
      li.addEventListener("click", () => selectFile(file, li));
      fileListEl.appendChild(li);
    });
  } catch (err) {
    fileListEl.innerHTML = `<li style="color:red;">Error loading files</li>`;
  }
}

async function selectFile(file, li) {
  [...fileListEl.children].forEach(el => el.classList.remove("active"));
  li.classList.add("active");

  const res = await fetch(file.download_url);
  const codeText = await res.text();

  currentCode = codeText;
  codeBlockEl.textContent = currentCode;
  hljs.highlightElement(codeBlockEl);
  hljs.lineNumbersBlock(codeBlockEl);

  // Load matching input
  const inputFileName = file.name.replace(/\.c$/, ".in");
  const inputUrl = file.download_url.replace(/\/[^\/]+$/, `/${inputFileName}`);
  try {
    const inputRes = await fetch(inputUrl);
    inputEl.value = inputRes.ok ? await inputRes.text() : "";
  } catch {
    inputEl.value = "";
  }

  outputEl.value = "";
  statusMsg.textContent = "";
}

async function runCode() {
  if (!currentCode) {
    alert("Please select a file first");
    return;
  }

  runBtn.disabled = true;
  statusMsg.textContent = "Running...";
  outputEl.value = "";

  try {
    const res = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=false&wait=true`, {
      method: "POST",
      headers: {
        "content-type": "application/json",
        "X-RapidAPI-Host": rapidApiHost,
        "X-RapidAPI-Key": rapidApiKey
      },
      body: JSON.stringify({
        source_code: currentCode,
        language_id: 50,
        stdin: inputEl.value
      })
    });

    const result = await res.json();
    if (result.stderr) outputEl.value = `Error:\n${result.stderr}`;
    else if (result.compile_output) outputEl.value = `Compile Error:\n${result.compile_output}`;
    else outputEl.value = result.stdout || "";
  } catch (e) {
    outputEl.value = "Error running code: " + e.message;
  } finally {
    statusMsg.textContent = "";
    runBtn.disabled = false;
  }
}

runBtn.addEventListener("click", runCode);
fetchFileList();
</script>

</body>
</html>
