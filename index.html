<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My C Practice Codes - Run Online</title>

<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212;
    color: #eee;
    display: flex;
    height: 100vh;
  }

  #file-list {
    width: 25%;
    background-color: #1e1e1e;
    overflow-y: auto;
    border-right: 1px solid #333;
  }

  #file-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #file-list li {
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid #333;
  }

  #file-list li:hover {
    background-color: #333;
  }

  #file-list li.active {
    background-color: #007acc;
    color: white;
  }

  #main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  header {
    padding: 10px 16px;
    background-color: #1e1e1e;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  header h1 {
    margin: 0;
    font-weight: 600;
    font-size: 1.5rem;
  }

  #run-btn {
    background-color: #007acc;
    color: white;
    border: none;
    padding: 8px 14px;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 4px;
  }

  #run-btn:hover {
    background-color: #005f99;
  }

  #code-container {
    flex-grow: 1;
    background: #1e1e1e;
    color: #eee;
    font-family: 'Fira Code', monospace, monospace;
    font-size: 14px;
    padding: 16px;
    overflow-y: auto;
    white-space: pre;
    line-height: 1.4em;
  }

  #input-label {
    padding: 8px 16px;
    background: #222;
    border-top: 1px solid #333;
  }

  #stdin {
    width: 100%;
    height: 80px;
    background: #222;
    color: #eee;
    font-family: monospace;
    font-size: 14px;
    border: none;
    padding: 8px;
    resize: vertical;
  }

  #output-container {
    background-color: #222;
    color: #0f0;
    padding: 10px 16px;
    font-family: monospace;
    height: 150px;
    overflow-y: auto;
    border-top: 1px solid #333;
    white-space: pre-wrap;
  }

  /* Syntax highlighting */
  .keyword { color: #569cd6; }
  .type { color: #4ec9b0; }
  .string { color: #d69d85; }
  .comment { color: #6a9955; font-style: italic; }
  .number { color: #b5cea8; }

</style>
</head>
<body>

<div id="file-list">
  <ul id="files-ul">
    <!-- File list here -->
  </ul>
</div>

<div id="main-content">
  <header>
    <h1>My C Practice Codes</h1>
    <button id="run-btn">Run</button>
  </header>

  <pre id="code-container">// Select a file from the left to load code here.</pre>

  <div id="input-label">Input (stdin):</div>
  <textarea id="stdin" placeholder="Enter input here..."></textarea>

  <div id="output-container">Output will appear here...</div>
</div>

<script>
const githubUser = 'wahidfarhan';
const repoName = 'Lazy_Farhan';
const folderPath = 'codes';

const filesUl = document.getElementById('files-ul');
const codeContainer = document.getElementById('code-container');
const outputContainer = document.getElementById('output-container');
const runBtn = document.getElementById('run-btn');
const stdinArea = document.getElementById('stdin');

let filesList = [];
let currentSelectedIndex = -1;
let currentCode = '';

function syntaxHighlight(code) {
  code = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  code = code.replace(/(\/\/.*?$)/gm, '<span class="comment">$1</span>');
  code = code.replace(/(\".*?\")/g, '<span class="string">$1</span>');

  const keywords = ['int', 'void', 'char', 'float', 'double', 'if', 'else', 'while', 'for', 'return', 'break', 'continue', 'struct', 'switch', 'case', 'default', 'sizeof', 'do'];
  const keywordRegex = new RegExp('\\b(' + keywords.join('|') + ')\\b', 'g');
  code = code.replace(keywordRegex, '<span class="keyword">$1</span>');

  const types = ['int', 'char', 'float', 'double', 'void', 'long', 'short', 'unsigned', 'signed', 'const'];
  const typeRegex = new RegExp('\\b(' + types.join('|') + ')\\b', 'g');
  code = code.replace(typeRegex, '<span class="type">$1</span>');

  code = code.replace(/\b(\d+)\b/g, '<span class="number">$1</span>');

  return code;
}

async function fetchFileList() {
  try {
    const res = await fetch(`https://api.github.com/repos/${githubUser}/${repoName}/contents/${folderPath}`);
    if (!res.ok) throw new Error(`HTTP error: ${res.status}`);
    const data = await res.json();

    filesList = data.filter(item => item.type === 'file' && item.name.endsWith('.c'));

    filesUl.innerHTML = '';
    filesList.forEach((file, idx) => {
      const li = document.createElement('li');
      li.textContent = file.name;
      li.addEventListener('click', () => selectFile(idx));
      filesUl.appendChild(li);
    });

  } catch (err) {
    codeContainer.textContent = 'Error loading files: ' + err.message;
  }
}

async function selectFile(idx) {
  if (currentSelectedIndex === idx) return;

  if (currentSelectedIndex !== -1) {
    filesUl.children[currentSelectedIndex].classList.remove('active');
  }

  currentSelectedIndex = idx;
  filesUl.children[idx].classList.add('active');

  outputContainer.textContent = 'Output will appear here...';
  stdinArea.value = '';

  try {
    const file = filesList[idx];
    const res = await fetch(file.download_url);
    if (!res.ok) throw new Error(`Failed to load code: ${res.status}`);
    const code = await res.text();
    currentCode = code;
    codeContainer.innerHTML = syntaxHighlight(code);
  } catch (err) {
    codeContainer.textContent = 'Error loading code: ' + err.message;
  }
}

async function runCode() {
  if (!currentCode) {
    outputContainer.textContent = 'Please select a code file first.';
    return;
  }

  outputContainer.textContent = 'Running code...';

  // Prepare data for Judge0 API
  // https://judge0.com/
  const payload = {
    language_id: 50,  // C (gcc)
    source_code: currentCode,
    stdin: stdinArea.value
  };

  try {
    // Create submission
    const response = await fetch('https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com',
        'X-RapidAPI-Key': '2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02' // তোমার RapidAPI key
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) throw new Error('Error from Judge0 API: ' + response.statusText);

    const result = await response.json();

    if (result.stdout) {
      outputContainer.textContent = result.stdout;
    } else if (result.compile_output) {
      outputContainer.textContent = "Compile error:\n" + result.compile_output;
    } else if (result.stderr) {
      outputContainer.textContent = "Runtime error:\n" + result.stderr;
    } else {
      outputContainer.textContent = "Unknown error occurred.";
    }
  } catch (err) {
    outputContainer.textContent = "Error: " + err.message;
  }
}

runBtn.addEventListener('click', runCode);

fetchFileList();

</script>
</body>
</html>
