<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Farhans Practice Problems - Monaco Editor</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark-reasonable.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wcoder/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.css" />

  <style>
    :root {
      --green: #238636;
      --green-light: #2ea043;
      --bg: #0d1117;
      --bg-alt: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --sidebar-width: 280px;
      --transition-speed: 0.3s;
      --scrollbar-bg: #1e1e1e; /* scrollbar background */
      --scrollbar-thumb: #02ff00; /* scrollbar thumb */
      --scrollbar-thumb-hover: #333;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #container {
      display: flex;
      flex: 1 1 auto;
      height: 100%;
      overflow: hidden;
      background: var(--bg);
    }
    #sidebar {
      width: var(--sidebar-width);
      background: var(--bg-alt);
      border-right: 3px solid var(--border);
      padding: 15px 10px 15px 15px;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-bg);
      transition: width var(--transition-speed);
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
    }
    #sidebar::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    #sidebar::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    #sidebar::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    #sidebar h2 {
      color: var(--green);
      border-bottom: 2px solid var(--green);
      margin-bottom: 15px;
      font-size: 1.25rem;
      user-select: none;
    }
    #fileList {
      list-style: none;
      padding: 0;
      margin: 0;
      flex-grow: 1;
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) #161b22;
    }
    #fileList::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    #fileList::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    #fileList::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    #fileList li {
      background: #21262d;
      padding: 8px 12px;
      margin-bottom: 6px;
      border-radius: 5px;
      cursor: pointer;
      transition: background var(--transition-speed), color var(--transition-speed);
      font-size: 0.9rem;
      user-select: none;
      overflow: hidden;
    }
    #fileList li.active {
      background: var(--green);
      color: white;
      font-weight: 600;
    }
    #fileList li:hover:not(.active) {
      background: var(--green-light);
      color: white;
    }
    #fileList li.back-button {
      font-weight: 700;
      background-color: #0a4d1b;
      color: #b2f2bb;
      margin-bottom: 12px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 0 6px 1px #238636aa;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    #fileList li.back-button:hover {
      background-color: #169a2c;
      color: white;
      box-shadow: 0 0 12px 2px #2ea043cc;
    }

    #main {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      padding: 15px 20px;
      overflow: hidden;
      min-width: 0;
    }
    #codeSection {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      flex: 1 1 auto;
      min-height: 600px;
      overflow: hidden;
    }
    #codeContainer {
      flex: 2 1 60%;
      min-width: 300px;
      border: 3px solid var(--green);
      border-radius: 6px;
      overflow: hidden; 
      max-height: 600px;
      background: #282c34;
    }
    #ioSide {
      flex: 1 1 35%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-width: 250px;
      max-height: 600px;
      overflow: hidden;
    }
    .io-box {
      display: flex;
      flex-direction: column;
      max-height: 33vh;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-bg);
    }
    .io-box::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    .io-box::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    .io-box::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    .io-box label {
      font-weight: bold;
      color: var(--green);
      margin-bottom: 5px;
      font-size: 0.95rem;
      user-select: none;
      flex-shrink: 0;
    }
    textarea, .readonly-box {
      width: 100%;
      background-color: #21262d;
      color: var(--text);
      border: 2px solid var(--green);
      border-radius: 5px;
      padding: 10px;
      resize: vertical;
      font-family: monospace;
      font-size: 14px;
      min-height: 80px;
      max-height: 150px;
      overflow-y: scroll;
      transition: border-color var(--transition-speed);
      flex-grow: 1;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-bg);
    }
    textarea::-webkit-scrollbar, .readonly-box::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    textarea::-webkit-scrollbar-thumb, .readonly-box::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    textarea::-webkit-scrollbar-thumb:hover, .readonly-box::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    textarea:focus {
      outline: none;
      border-color: var(--green-light);
      background-color: #1c252b;
    }
    .readonly-box {
      background-color: #1e1e1e;
      white-space: pre-wrap;
    }
    #descriptionBox {
      min-height: 190px;
      max-height: 250px;
      overflow-y: scroll;
      flex-grow: 1;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-bg);
    }
    #descriptionBox::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    #descriptionBox::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    #descriptionBox::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    #runBtn {
      margin-top: 15px;
      background: var(--green);
      border: none;
      padding: 14px 24px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      font-size: 17px;
      cursor: pointer;
      align-self: flex-start;
      transition: background var(--transition-speed);
      user-select: none;
      min-width: 120px;
    }
    #runBtn:hover, #runBtn:focus {
      background: var(--green-light);
      outline: none;
    }
    #statusMsg {
      margin-top: 10px;
      font-style: italic;
      color: #999;
      min-height: 22px;
      user-select: none;
    }
    #expectedOutput {
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
      max-height: 140px;
      overflow-y: scroll;
      flex-grow: 1;
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-thumb) #1e1e1e;
    }
    #expectedOutput::-webkit-scrollbar {
      width: 12px;
      background-color: var(--scrollbar-bg);
    }
    #expectedOutput::-webkit-scrollbar-thumb {
      background-color: var(--scrollbar-thumb);
      border-radius: 6px;
      border: 3px solid var(--scrollbar-bg);
    }
    #expectedOutput::-webkit-scrollbar-thumb:hover {
      background-color: var(--scrollbar-thumb-hover);
    }
    #uploadedDate {
      margin-top: 10px;
      font-size: 0.9em;
      color: #56d364;
      text-align: right;
      user-select: none;
      flex-shrink: 0;
    }
    #fileNameLabel {
      color: #56d364;
      font-weight: normal;
      font-size: 0.9em;
      margin-left: 8px;
      user-select: none;
    }
    #typingContainer {
      height: 40px;
      background: var(--bg-alt);
      border-top: 3px solid var(--green);
      color: var(--green);
      font-family: 'Courier New', Courier, monospace;
      font-weight: bold;
      font-size: 18px;
      padding-left: 15px;
      display: flex;
      align-items: center;
      overflow: hidden;
      user-select: none;
      flex-shrink: 0;
    }
    #typingText {
      border-right: 2px solid var(--green);
      white-space: nowrap;
      overflow: hidden;
    }
    @media (max-width: 1024px) {
      #codeContainer {
        max-height: 400px;
      }
      #ioSide {
        max-height: 400px;
      }
    }
    @media (max-width: 768px) {
      body {
        height: auto;
      }
      #container {
        flex-direction: column;
        height: auto;
      }
      #sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 3px solid var(--border);
        padding: 10px 10px 10px 10px;
        max-height: 240px;
        overflow-y: scroll;
      }
      #sidebar h2 {
        font-size: 1.1rem;
      }
      #fileList li {
        font-size: 0.85rem;
        padding: 8px 10px;
      }
      #main {
        padding: 15px 10px 10px 10px;
      }
      #codeSection {
        flex-direction: column;
        gap: 15px;
      }
      #codeContainer {
        flex: none;
        min-width: 100%;
        max-height: 350px;
        min-height: 300px;
        border-radius: 5px;
      }
      #ioSide {
        flex: none;
        min-width: 100%;
        max-height: none;
      }
      #runBtn {
        width: 100%;
        font-size: 16px;
        padding: 14px 0;
        min-width: unset;
      }
      #typingContainer {
        font-size: 16px;
        height: 35px;
        padding-left: 10px;
      }
      #uploadedDate {
        text-align: center;
      }
      #descriptionBox {
        max-height: 300px;
        min-height: 150px;
      }
    }
    @media (max-width: 480px) {
      #sidebar {
        max-height: 200px;
        padding: 8px 8px 8px 8px;
      }
      #sidebar h2 {
        font-size: 1rem;
      }
      #fileList li {
        font-size: 0.8rem;
        padding: 6px 8px;
      }
      #codeContainer pre {
        font-size: 13px;
        padding: 12px;
        min-height: 250px;
      }
      textarea, .readonly-box {
        font-size: 13px;
        min-height: 70px;
        max-height: 120px;
      }
      #runBtn {
        font-size: 15px;
        padding: 12px 0;
      }
      #typingContainer {
        font-size: 14px;
        height: 30px;
        padding-left: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar" role="navigation" aria-label="File list">
      <h2>Farhans Practice Problems</h2>
      <ul id="fileList" tabindex="0"><li>Loading folders...</li></ul>
    </div>
    <div id="main">
      <div id="codeSection">
        <div id="codeContainer" aria-label="Code display area"></div>
        <div id="ioSide">
          <div class="io-box">
            <label for="input">📥 Input</label>
            <textarea id="input" placeholder="Input will be loaded here or you can type" spellcheck="false" autocomplete="off"></textarea>
          </div>
          <div class="io-box">
            <label for="output">📤 Output</label>
            <textarea id="output" readonly placeholder="Program output will appear here" spellcheck="false" autocomplete="off"></textarea>
          </div>
          <div class="io-box">
            <label>✅ Expected Output</label>
            <div id="expectedOutput" class="readonly-box" tabindex="0" aria-live="polite">Not loaded</div>
          </div>
          <div class="io-box" style="flex-grow:1; display:flex; flex-direction:column;">
            <label>📝 Description <span id="fileNameLabel"></span></label>
            <div id="descriptionBox" class="readonly-box" tabindex="0" aria-live="polite" style="flex-grow:1; overflow-y: scroll;">No description available.</div>
          </div>
        </div>
      </div>
      <button id="runBtn" aria-label="Run code">Run Code</button>
      <div id="statusMsg" role="status" aria-live="polite"></div>
      <div id="uploadedDate" aria-label="Last uploaded date"></div>
    </div>
  </div>
  <div id="typingContainer" aria-live="polite" aria-atomic="true">
    <div id="typingText"></div>
  </div>

  <!-- Monaco editor loader -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>

  <script>
    const repoOwner = "wahidfarhan";
    const repoName = "Lazy_Farhan";
    const folderPathRoot = "";

    const rapidApiHost = "judge0-ce.p.rapidapi.com";
    const rapidApiKey = "2ffb7c9968msh2aaee0147c376edp10350djsne858c3d03a02";

    const proxyUrl = "https://corsproxy.io/?";

    const fileListEl = document.getElementById("fileList");
    const inputEl = document.getElementById("input");
    const outputEl = document.getElementById("output");
    const runBtn = document.getElementById("runBtn");
    const statusMsg = document.getElementById("statusMsg");
    const descriptionEl = document.getElementById("descriptionBox");
    const expectedOutputEl = document.getElementById("expectedOutput");
    const fileNameLabel = document.getElementById("fileNameLabel");
    const uploadedDateEl = document.getElementById("uploadedDate");
    const codeContainer = document.getElementById("codeContainer");

    let currentCode = "";
    let currentPath = "";
    let folderStack = [];

    let editor = null; // monaco editor instance

    // Load Monaco Editor
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
    require(['vs/editor/editor.main'], function () {
      editor = monaco.editor.create(codeContainer, {
        value: "",
        language: "c",
        theme: "vs-dark",
        automaticLayout: true,
        fontSize: 14,
        minimap: { enabled: false },
        lineNumbers: "on",
        scrollBeyondLastLine: false,
      });
    });

    // Fetch folder contents from GitHub API with proxy
    async function fetchFolderContent(path) {
      try {
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
        const res = await fetch(proxyUrl + apiUrl);
        if (!res.ok) throw new Error("Failed to fetch folder contents");
        const data = await res.json();
        return data;
      } catch (err) {
        fileListEl.innerHTML = `<li style="color:red;">Error loading folder contents</li>`;
        console.error(err);
        return null;
      }
    }

    // Fetch last commit date for file
    async function getFileLastCommitDate(filePath) {
      try {
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/commits?path=${filePath}&page=1&per_page=1`;
        const res = await fetch(proxyUrl + apiUrl);
        if (!res.ok) throw new Error("Failed to fetch last commit");
        const data = await res.json();
        if (data && data.length > 0) {
          return new Date(data[0].commit.committer.date);
        }
        return null;
      } catch (err) {
        console.error(err);
        return null;
      }
    }

    // Show folder contents in sidebar
    async function showFolder(path) {
      fileListEl.innerHTML = `<li>Loading...</li>`;
      const data = await fetchFolderContent(path);
      if (!data) return;

      // Sort: folders first, then files
      data.sort((a, b) => {
        if (a.type === b.type) return a.name.localeCompare(b.name);
        return a.type === "dir" ? -1 : 1;
      });

      // Push current folder to stack (for back navigation)
      if (!folderStack.length || folderStack[folderStack.length -1] !== path) {
        folderStack.push(path);
      }
      currentPath = path;

      let listItems = [];

      // Add back button if not root
      if (folderStack.length > 1) {
        listItems.push(`<li class="back-button" tabindex="0" role="button" aria-label="Go back to previous folder">⬅ Back</li>`);
      }

      for (const item of data) {
        if (item.type === "dir") {
          listItems.push(`<li class="folder-item" tabindex="0" role="button" aria-label="Open folder ${item.name}" data-path="${item.path}">📁 ${item.name}</li>`);
        } else if (item.type === "file" && item.name.endsWith(".c")) {
          listItems.push(`<li class="file-item" tabindex="0" role="button" aria-label="Open file ${item.name}" data-path="${item.path}">📄 ${item.name}</li>`);
        }
      }
      fileListEl.innerHTML = listItems.join("");
    }

    // Load code file content from GitHub API with proxy
    async function loadCodeFile(path) {
      try {
        // Reset UI
        statusMsg.textContent = "Loading file...";
        outputEl.value = "";
        inputEl.value = "";
        expectedOutputEl.textContent = "Not loaded";
        descriptionEl.textContent = "Loading description...";
        uploadedDateEl.textContent = "";
        fileNameLabel.textContent = `(${path.split('/').pop()})`;

        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${path}`;
        const res = await fetch(proxyUrl + apiUrl);
        if (!res.ok) throw new Error("Failed to fetch code file");
        const data = await res.json();

        if (data.encoding !== "base64") throw new Error("Unsupported encoding");

        // Decode base64 content
        const content = atob(data.content.replace(/\n/g, ''));
        currentCode = content;

        // Set code in monaco editor
        if (editor) {
          editor.setValue(content);
          // Set language based on file extension
          const ext = path.split('.').pop().toLowerCase();
          if (ext === "c") monaco.editor.setModelLanguage(editor.getModel(), "c");
          else monaco.editor.setModelLanguage(editor.getModel(), "plaintext");
        }

        statusMsg.textContent = "File loaded.";
        
        // Load input.txt, output.txt, description.txt if exist in same folder
        const folder = path.substring(0, path.lastIndexOf("/"));
        await loadAdditionalFiles(folder);

        // Load last commit date for file
        const date = await getFileLastCommitDate(path);
        if (date) {
          uploadedDateEl.textContent = `Last updated: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
        } else {
          uploadedDateEl.textContent = "";
        }
      } catch (err) {
        statusMsg.textContent = "Error loading file.";
        descriptionEl.textContent = "";
        expectedOutputEl.textContent = "Not loaded";
        console.error(err);
      }
    }

    // Load input.txt, output.txt, description.txt files for a folder (optional)
    async function loadAdditionalFiles(folder) {
      try {
        // input.txt
        const inputUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}/input.txt`;
        const inputRes = await fetch(proxyUrl + inputUrl);
        if (inputRes.ok) {
          const inputData = await inputRes.json();
          if (inputData.encoding === "base64") {
            inputEl.value = atob(inputData.content.replace(/\n/g, ''));
          }
        } else {
          inputEl.value = "";
        }
      } catch {
        inputEl.value = "";
      }

      try {
        // output.txt
        const outputUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}/output.txt`;
        const outputRes = await fetch(proxyUrl + outputUrl);
        if (outputRes.ok) {
          const outputData = await outputRes.json();
          if (outputData.encoding === "base64") {
            expectedOutputEl.textContent = atob(outputData.content.replace(/\n/g, ''));
          }
        } else {
          expectedOutputEl.textContent = "Not loaded";
        }
      } catch {
        expectedOutputEl.textContent = "Not loaded";
      }

      try {
        // description.txt
        const descUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folder}/description.txt`;
        const descRes = await fetch(proxyUrl + descUrl);
        if (descRes.ok) {
          const descData = await descRes.json();
          if (descData.encoding === "base64") {
            descriptionEl.textContent = atob(descData.content.replace(/\n/g, ''));
          }
        } else {
          descriptionEl.textContent = "No description available.";
        }
      } catch {
        descriptionEl.textContent = "No description available.";
      }
    }

    // Run code via Judge0 API
    async function runCode() {
      if (!currentCode.trim()) {
        statusMsg.textContent = "No code to run.";
        return;
      }

      statusMsg.textContent = "Running code...";
      outputEl.value = "";

      const encodedSourceCode = btoa(unescape(encodeURIComponent(editor.getValue())));
      const encodedInput = btoa(unescape(encodeURIComponent(inputEl.value)));

      const language_id = 50; // C language id for Judge0

      const payload = {
        language_id: language_id,
        source_code: encodedSourceCode,
        stdin: encodedInput,
        // Expected output is not sent to Judge0, but can be used locally if needed
      };

      try {
        const response = await fetch(`https://${rapidApiHost}/submissions?base64_encoded=true&wait=true`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-RapidAPI-Host": rapidApiHost,
            "X-RapidAPI-Key": rapidApiKey,
          },
          body: JSON.stringify(payload),
        });

        if (!response.ok) throw new Error("Error from Judge0 API");

        const result = await response.json();

        let outputText = "";

        if (result.stdout) {
          outputText = decodeURIComponent(escape(atob(result.stdout)));
        } else if (result.stderr) {
          outputText = "Error:\n" + decodeURIComponent(escape(atob(result.stderr)));
        } else if (result.compile_output) {
          outputText = "Compile Error:\n" + decodeURIComponent(escape(atob(result.compile_output)));
        } else {
          outputText = "No output returned.";
        }

        outputEl.value = outputText;
        statusMsg.textContent = "Execution finished.";
      } catch (err) {
        outputEl.value = "";
        statusMsg.textContent = "Error running code.";
        console.error(err);
      }
    }

    // Typing animation for "Farhan Wahid" at bottom bar
    const typingTextEl = document.getElementById("typingText");
    const typingStr = "Farhan Wahid";
    let typingIndex = 0;
    let typingForward = true;
    function typingAnimation() {
      if (typingForward) {
        typingIndex++;
        if (typingIndex >= typingStr.length) {
          typingForward = false;
          setTimeout(typingAnimation, 1000);
          return;
        }
      } else {
        typingIndex--;
        if (typingIndex <= 0) {
          typingForward = true;
          setTimeout(typingAnimation, 500);
          return;
        }
      }
      typingTextEl.textContent = typingStr.slice(0, typingIndex);
      setTimeout(typingAnimation, typingForward ? 200 : 120);
    }
    typingAnimation();

    // Event delegation for file/folder clicks
    fileListEl.addEventListener("click", (e) => {
      const li = e.target.closest("li");
      if (!li) return;

      if (li.classList.contains("back-button")) {
        // Go back folder
        if (folderStack.length > 1) {
          folderStack.pop();
          const prevFolder = folderStack[folderStack.length - 1];
          showFolder(prevFolder);
        }
      } else if (li.classList.contains("folder-item")) {
        const path = li.dataset.path;
        showFolder(path);
      } else if (li.classList.contains("file-item")) {
        const path = li.dataset.path;
        loadCodeFile(path);
      }
    });

    // Keyboard accessibility for file/folder list (Enter/Space)
    fileListEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        e.target.click();
      }
    });

    // Run button
    runBtn.addEventListener("click", runCode);

    // Load initial folder (root)
    showFolder(folderPathRoot);

  </script>
</body>
</html>
